<!-- PerfilesComponent Template -->
<section class="px-4 sm:px-6 pt-6 pb-12 bg-slate-50 min-h-screen">
  <!-- <div class="px-4 sm:px-6 pt-6 pb-12 bg-slate-50 min-h-screen"></div> -->
  <!-- <section class="bg-neutral-50 min-h-screen p-6"> -->
  <!-- Botón regresar -->
  <div class="max-w-screen-2xl mx-auto mb-4">
    <button
      class="inline-flex items-center gap-2 border border-[#44509D] text-[#44509D] px-3 py-2 rounded-md hover:bg-[#44509D] hover:text-white transition"
      (click)="regresar()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
        <path fill-rule="evenodd"
          d="M10.53 4.47a.75.75 0 010 1.06L5.81 10.25H21a.75.75 0 010 1.5H5.81l4.72 4.72a.75.75 0 11-1.06 1.06l-6-6a.75.75 0 010-1.06l6-6a.75.75 0 011.06 0z"
          clip-rule="evenodd" />
      </svg>
      Regresar
    </button>
  </div>

  <div class="max-w-screen-2xl mx-auto bg-white border border-neutral-200 rounded-xl shadow-sm p-6">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-start gap-6">
      <img [src]="docente?.foto_url || 'https://placehold.co/160x160?text=Foto'" alt="Foto"
        class="w-28 h-28 rounded-lg object-cover border-2 border-[#44509D]" />

      <div class="flex-1">
        <h1 class="text-2xl md:text-3xl font-semibold text-neutral-900 leading-tight">
          {{ docente?.nombre || 'Pendiente' }} {{ docente?.apellidos || '' }}
        </h1>
        <p class="text-neutral-700 mt-1">{{ docente?.especialidad || 'Especialidad pendiente' }}</p>

        <div class="flex flex-wrap items-center gap-2 mt-3">
          <span
            class="inline-flex items-center gap-2 text-xs px-2.5 py-1 rounded-full border border-neutral-300 bg-neutral-100 text-neutral-800">
            <span class="inline-block w-1.5 h-1.5 rounded-full bg-[#44509D]"></span>
            Registrado: {{ docente?.created_at ? (docente.created_at | date:'d/M/yyyy') : '—' }}
          </span>
          <!-- CHIP de estatus homologado -->
          <span class="inline-flex items-center text-xs px-2.5 py-1 rounded-full font-medium"
            [ngClass]="estatusChipClass(docente?.estatus_valor)">
            {{ docente?.estatus_valor || 'Estatus' }}
          </span>
        </div>
      </div>

      <div class="shrink-0">
        <button
          class="w-full md:w-auto border border-[#44509D] text-[#44509D] px-3 py-2 rounded-md hover:bg-[#44509D] hover:text-white transition"
          (click)="abrirModal()">
          Modificar estatus
        </button>
      </div>
    </div>

    <!-- Tabs -->
    <div class="mt-6">
      <div class="border-b border-neutral-200">
        <nav class="-mb-px flex flex-wrap gap-4" aria-label="Tabs">
          <button type="button" (click)="setTab('general')" [class]="tabClass('general')">Información General</button>
          <button type="button" (click)="setTab('solicitudes')" [class]="tabClass('solicitudes')">Solicitudes de
            Cursos</button>
          <button type="button" (click)="setTab('documentos')" [class]="tabClass('documentos')">Documentos</button>
          <button type="button" (click)="setTab('contacto')" [class]="tabClass('contacto')">Contacto</button>
        </nav>
      </div>

      <!-- Panel: General -->
      <div *ngIf="isTab('general')" class="pt-6 space-y-6">
        <h2 class="text-xl font-semibold text-neutral-900">Información General</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Datos personales -->
          <div class="border border-neutral-200 rounded-lg p-4">
            <div class="flex items-center gap-2 mb-3">
              <span
                class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-[#44509D] text-white text-xs">ID</span>
              <h3 class="font-medium text-neutral-900">Datos personales</h3>
            </div>
            <dl class="text-sm text-neutral-700 space-y-3">
              <div class="flex justify-between gap-6">
                <dt class="text-neutral-500">Nombre completo</dt>
                <dd class="text-right font-medium">{{ docente?.nombre || '—' }} {{ docente?.apellidos || '' }}</dd>
              </div>
              <div class="flex justify-between gap-6">
                <dt class="text-neutral-500">Correo</dt>
                <dd class="text-right font-medium">{{ docente?.email || '—' }}</dd>
              </div>
              <div class="flex justify-between gap-6">
                <dt class="text-neutral-500">Teléfono</dt>
                <dd class="text-right font-medium">{{ docente?.telefono || '—' }}</dd>
              </div>

            </dl>
          </div>

          <!-- Estado del perfil -->
          <div class="border border-neutral-200 rounded-lg p-4 bg-neutral-50">
            <div class="flex items-center gap-2 mb-3">
              <span
                class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-neutral-200 text-[#44509D] text-xs font-semibold">ST</span>
              <h3 class="font-medium text-neutral-900">Estado del perfil</h3>
            </div>
            <dl class="text-sm text-neutral-700 space-y-3">
              <div class="flex justify-between gap-6">
                <dt class="text-neutral-500">Estatus actual</dt>
                <dd class="text-right">
                  <span class="inline-flex items-center text-xs px-2.5 py-1 rounded-full font-medium"
                    [ngClass]="estatusChipClass(docente?.estatus_valor)">
                    {{ docente?.estatus_valor || '—' }}
                  </span>
                </dd>
              </div>
              <div class="flex justify-between gap-6">
                <dt class="text-neutral-500">Última actualización</dt>
                <dd class="text-right font-medium">{{ docente?.updated_at ? (docente.updated_at | date:'d/M/yyyy') : '—'
                  }}</dd>
              </div>

            </dl>
          </div>
        </div>









      </div>
      <div *ngIf="isTab('solicitudes')" class="pt-6 space-y-6">
        <div *ngFor="let s of solicitudes()"
          class="rounded-xl border border-neutral-200 bg-white shadow-sm hover:shadow-md transition">
          <!-- Header -->
          <div class="flex flex-col gap-3 p-4 md:flex-row md:items-start md:justify-between md:gap-4"
            *ngIf="cursosMap().get(s.cursoId) as curso">
            <!-- IZQ -->
            <div class="min-w-0 flex-1">
              <h3 class="text-lg font-semibold text-slate-900 truncate">
                {{ curso.nombre }}
              </h3>

              <div class="mt-2 flex flex-wrap items-center gap-2 text-xs">
                <!-- Tipo curso -->
                <span
                  class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-2.5 py-1 text-slate-700 ring-1 ring-slate-200">
                  <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="currentColor">
                    <path
                      d="M3 21h18v-2H3v2Zm2-4h2v-2H5v2Zm4 0h2v-2H9v2Zm4 0h2v-2h-2v2Zm4 0h2v-2h-2v2ZM5 13h2v-2H5v2Zm4 0h2v-2H9v2Zm4 0h2v-2h-2v2Zm4 0h2v-2h-2v2ZM5 9h2V7H5v2Zm4 0h2V7H9v2Zm4 0h2V7h-2v2Zm4 0h2V7h-2v2ZM7 3v2h10V3H7Z" />
                  </svg>
                  {{ curso.tipo_curso_nombre }}
                </span>

                <!-- Fecha -->
                <span
                  class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-2.5 py-1 text-slate-700 ring-1 ring-slate-200">
                  <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7 2h2v2h6V2h2v2h3v18H4V4h3V2Zm12 8H5v10h14V10Z" />
                  </svg>
                  {{ s.fechaSolicitud | date: "d/M/yyyy" }}
                </span>

                <!-- Prioridad -->
                <span class="inline-flex items-center gap-1 rounded-full px-2.5 py-1"
                  [ngClass]="prioridadClasses(s.prioridad)">
                  <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="currentColor">
                    <path
                      d="M13.5 2S18 6 18 10.5A6.5 6.5 0 1 1 5 10c0-2.9 2-5.2 4.5-6.5-.6 1.7-.4 3.6.7 4.9 1.1-1.3 1.6-3.3 1.3-5.4Z" />
                  </svg>
                  Prioridad {{ s.prioridad }}
                </span>
              </div>
            </div>

            <!-- DER header -->
            <div class="flex items-center gap-3 shrink-0">
              <span class="inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium"
                [ngClass]="estadoClasses(s.estado)">
                {{ estadoIcon(s.estado) }} {{ s.estado }}
              </span>

              <button type="button" class="p-1.5 rounded-lg border border-slate-200 hover:bg-slate-100"
                (click)="toggleEdit(s.id)" [attr.aria-pressed]="isEditing(s.id)">
                <span *ngIf="!isEditing(s.id)" class="material-symbols-outlined text-lg">edit_square</span>
                <span *ngIf="isEditing(s.id)" class="material-symbols-outlined text-lg">cancel</span>
              </button>
            </div>
          </div>

          <!-- CONTENIDO -->
          <div class="p-4 pt-0 md:p-4">
            <div class="grid grid-cols-1 gap-4" [ngClass]="{ 'md:grid-cols-3 lg:grid-cols-4': isEditing(s.id) }">
              <!-- Columna principal -->
              <div [ngClass]="{
            'md:col-span-2 lg:col-span-3': isEditing(s.id),
            'col-span-1': !isEditing(s.id)
          }">
                <p class="text-xs font-medium text-slate-700 mb-1">Justificación:</p>
                <div class="rounded-lg bg-slate-50 p-3 text-sm text-slate-700 ring-1 ring-slate-200">
                  {{ s.justificacion }}
                </div>

                <!-- Comentarios del Validador -->
                <div *ngIf="s.respuestaMensaje" class="mt-3 rounded-lg bg-blue-50 p-3 ring-1 ring-blue-200">
                  <div class="mb-1 flex items-center gap-2 text-xs font-semibold text-blue-900">
                    <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm1 15h-2v-6h2v6Zm0-8h-2V7h2v2Z" />
                    </svg>
                    Comentarios del Validador:
                  </div>
                  <p class="text-sm text-blue-900/90">
                    {{ s.respuestaMensaje || "Sin comentarios del evaluador" }}
                  </p>
                </div>
              </div>

              <!-- Panel DER solo en edición -->
              <div *ngIf="isEditing(s.id)" class="md:col-span-1">
                <div class="rounded-lg border bg-white p-4 shadow-inner">
                  <div class="flex items-center justify-between gap-2">
                    <p class="text-sm font-semibold text-slate-800">
                      Estado de Solicitud
                    </p>
                    <span class="text-[11px] font-medium px-2 py-0.5 rounded-full" [ngClass]="estadoClasses(s.estado)">
                      {{ s.estado }}
                    </span>
                  </div>

                  <div class="mt-3 space-y-2 text-sm">
                    <div class="flex items-center justify-between gap-2">
                      <span class="text-slate-500">Fecha:</span>
                      <span class="font-medium truncate">{{
                        s.fechaSolicitud | date: "yyyy-MM-dd"
                        }}</span>
                    </div>

                    <div class="flex items-center justify-between gap-2">
                      <span class="text-slate-500">Prioridad:</span>
                      <span class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs"
                        [ngClass]="prioridadClasses(s.prioridad)">
                        {{ s.prioridad }}
                      </span>
                    </div>
                  </div>

                  <div class="mt-3">
                    <label class="text-xs text-slate-600">Cambiar Estado</label>
                    <select class="mt-1 w-full rounded-md border-slate-200 text-sm" [(ngModel)]="s.estado">
                      <option [ngValue]="'Pendiente'">Pendiente</option>
                      <option [ngValue]="'En Revisión'">En Revisión</option>
                      <option [ngValue]="'Aprobado'">Aprobado</option>
                      <option [ngValue]="'Rechazado'">Rechazado</option>
                    </select>
                  </div>

                  <div class="mt-3">
                    <label class="text-xs text-slate-600">Comentarios</label>
                    <textarea class="mt-1 w-full rounded-md border-slate-200 text-sm" rows="3"
                      placeholder="Agregar comentarios…" [(ngModel)]="s.respuestaMensaje"></textarea>
                  </div>

                  <div class="mt-4 flex gap-2">
                    <button
                      class="flex-1 rounded-md bg-[#44509D] text-white text-sm py-2 hover:bg-[#364283] transition disabled:opacity-60 disabled:cursor-not-allowed"
                      type="button" [disabled]="isSaving(s.id)" (click)="onActualizar(s)">
                      <span *ngIf="!isSaving(s.id)">Actualizar Solicitud</span>
                      <span *ngIf="isSaving(s.id)">Guardando…</span>
                    </button>

                    <button type="button" class="px-3 rounded-md border text-sm hover:bg-slate-50"
                      (click)="toggleEdit(s.id)">
                      Cancelar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>





      <!-- Panel: Documentos -->
      <div *ngIf="isTab('documentos')" class="pt-6 space-y-4">
        <h2 class="text-[18px] font-semibold mb-1">Documentación</h2>
        <p class="text-slate-500 text-sm mb-4">Cédula, identificación y CV del docente</p>

        <form class="flex flex-col gap-4">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-stretch">
            <app-pdf-uploader-preview class="h-full" [label]="'Documento de Identificación (PDF)'"
              [placeholder]="'https://...'" [url]="docente.documento_identificacion"
              [targetFolder]="'documentos_identificacion_docentes'" [allowUpload]="editMode">
            </app-pdf-uploader-preview>
            <app-pdf-uploader-preview class="h-full" [label]="'Cédula Profesional (PDF)'" [placeholder]="'https://...'"
              [url]="docente.cedula_profesional" [targetFolder]="'documentos_identificacion_docentes'"
              [allowUpload]="editMode">
            </app-pdf-uploader-preview>
            <app-pdf-uploader-preview class="h-full" [label]="'Curriculum (CV en PDF)'" [placeholder]="'https://...'"
              [url]="docente.curriculum_url" [targetFolder]="'documentos_identificacion_docentes'"
              [allowUpload]="editMode">
            </app-pdf-uploader-preview>

          </div>
        </form>



      </div>

      <!-- Panel: Contacto -->
      <div *ngIf="isTab('contacto')" class="pt-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="border border-neutral-200 rounded-lg p-4">
            <div class="text-sm text-neutral-500">Teléfono</div>
            <div class="mt-1 font-medium text-neutral-900">{{ docente?.telefono || 'Pendiente' }}</div>
          </div>
          <div class="border border-neutral-200 rounded-lg p-4">
            <div class="text-sm text-neutral-500">Correo</div>
            <div class="mt-1">
              <a *ngIf="docente?.email" [href]="'mailto:' + docente.email"
                class="underline text-[#44509D] hover:text-[#33407a]">
                {{ docente.email }}
              </a>
              <span *ngIf="!docente?.email" class="text-neutral-600">Pendiente</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Cambiar Estatus -->
  <div *ngIf="mostrarModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
    <div class="bg-white w-full max-w-sm rounded-xl shadow-lg border border-neutral-200 p-6 relative">
      <button class="absolute top-3 right-3 text-neutral-500 hover:text-neutral-900" (click)="cerrarModal()"
        aria-label="Cerrar">✕</button>
      <h3 class="text-lg font-semibold text-neutral-900 text-center">Modificar estatus del perfil</h3>
      <p class="text-sm text-neutral-600 mt-2">Selecciona el nuevo estatus. Esto afecta la visibilidad y acceso.</p>

      <label for="estatus" class="block text-sm font-medium text-neutral-800 mt-4">Nuevo estatus</label>
      <select id="estatus" [(ngModel)]="docente.estatus_valor"
        class="mt-1 block w-full border border-neutral-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#44509D] focus:border-[#44509D]">
        <option value="Activo">Activo</option>
        <option value="Inactivo">Inactivo</option>
        <option value="Pendiente de validación">Pendiente de validación</option>
        <option value="Suspendido">Suspendido</option>
      </select>

      <div class="mt-6 flex justify-end gap-3">
        <button class="px-3 py-2 rounded-md border border-neutral-300 text-neutral-700 hover:bg-neutral-100"
          (click)="cerrarModal()">Cancelar</button>
        <button class="px-3 py-2 rounded-md border border-[#44509D] text-[#44509D] hover:bg-[#44509D] hover:text-white"
          (click)="actualizarEstatus()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Especialidad -->
  <div *ngIf="mostrarModal_especialidad" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
    <div class="bg-white w-full max-w-lg rounded-xl shadow-lg border border-neutral-200 p-6 relative">
      <button class="absolute top-3 right-3 text-neutral-500 hover:text-neutral-900"
        (click)="cerrarModal_especialidad()" aria-label="Cerrar">✕</button>

      <h3 class="text-lg font-semibold text-neutral-900">Modificar especialidad</h3>
      <div class="mt-4 grid grid-cols-1 gap-4">
        <div>
          <label class="block text-sm font-medium text-neutral-800">Nombre</label>
          <input type="text" [(ngModel)]="especialidadSeleccionada.especialidad"
            class="mt-1 w-full border border-neutral-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#44509D]" />
        </div>
        <div>
          <label class="block text-sm font-medium text-neutral-800">Estado</label>
          <select [(ngModel)]="especialidadSeleccionada.estatus"
            class="mt-1 w-full border border-neutral-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#44509D]">
            <option value="aprobado">Aprobado</option>
            <option value="pendiente">Pendiente</option>
            <option value="rechazado">Rechazado</option>
          </select>
        </div>
      </div>
      <div class="mt-6 flex justify-end gap-3">
        <button class="px-3 py-2 rounded-md border border-neutral-300 text-neutral-700 hover:bg-neutral-100"
          (click)="cerrarModal_especialidad()">Cancelar</button>
        <button class="px-3 py-2 rounded-md border border-[#44509D] text-[#44509D] hover:bg-[#44509D] hover:text-white"
          (click)="guardarCambios_especialidad()">Guardar</button>
      </div>
    </div>
  </div>
</section>